{% extends "layouts/main.html" %}
{% extends "design-history/template.html" %}


{% block pageTitle %}
Prototypes – {{ serviceName }} - Product information
{% endblock %}

{% block head %}
{{ super() }}
<style>
  .image-container {
    border: 1px solid #b1b4b6;
    border-radius: 4px;
    padding: 0;
    overflow: hidden;
    position: relative;
    background-color: #f8f8f8;
  }

  .image-wrapper {
    position: relative;
    text-align: center;
    min-height: 300px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .preview-image {
    max-width: 100%;
    height: auto;
    display: block;
    margin: 0 auto;
  }

  .image-controls {
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 20;
    display: flex;
    gap: 8px;
    opacity: 1;
    background-color: rgba(0, 0, 0, 0.8);
    border-radius: 12px;
    padding: 6px 8px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
  }

  .image-tab {
    background-color: transparent;
    border: 2px solid transparent;
    border-radius: 8px;
    padding: 8px;
    font-size: 18px;
    line-height: 1;
    text-decoration: none;
    cursor: pointer;
    color: white;
    font-weight: 400;
    box-shadow: none;
    transition: all 0.2s ease;
    font-family: "GDS Transport", arial, sans-serif;
    min-width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    vertical-align: middle;
  }


  .image-tab:hover {
    background-color: rgba(255, 255, 255, 0.3);
    border-color: rgba(255, 255, 255, 0.6);
    color: white;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
  }

  .image-tab:active {
    background-color: rgba(255, 255, 255, 0.4);
    border-color: rgba(255, 255, 255, 0.8);
    color: white;
    transform: translateY(1px);
    box-shadow: 0 1px 4px rgba(0, 0, 0, 0.4);
  }

  .image-container.fullscreen {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100vh;
    z-index: 9999;
    background-color: white;
  }

  .image-container.fullscreen .image-tabs {
    position: fixed;
    z-index: 9999;
    background-color: white;
  }

  .image-container.fullscreen .image-wrapper {
    height: calc(100vh - 50px);
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 20px;
  }

  .image-container.fullscreen .preview-image {
    max-width: 100%;
    max-height: 100%;
    width: auto;
    height: auto;
  }

  .zoom-info {
    position: absolute;
    bottom: 20px;
    right: 10px;
    background-color: rgba(0, 0, 0, 0.95);
    color: white;
    padding: 8px 12px;
    border-radius: 6px;
    font-size: 14px;
    font-weight: 500;
    z-index: 20;
    opacity: 1;
    border: 1px solid rgba(255, 255, 255, 0.2);
  }

  .preview-image {
    transition: transform 0.1s ease;
    cursor: grab;
    user-select: none;
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
  }

  .preview-image:active {
    cursor: grabbing;
  }

  .preview-image.zoomed {
    transform-origin: center;
    cursor: grab;
  }

  .preview-image.zoomed:active {
    cursor: grabbing;
  }

  .image-wrapper {
    overflow: hidden;
    position: relative;
    cursor: default;
  }

  .image-wrapper.panning {
    cursor: grabbing;
  }

  .image-wrapper.panning .preview-image {
    cursor: grabbing !important;
  }

  .image-tab:focus {
    outline: 3px solid #fd0;
    outline-offset: 0;
    box-shadow: 0 0 0 3px #fd0;
  }

  .image-tab:focus:not(:active):not(:hover) {
    background-color: #fd0;
    border-color: #fd0;
    color: #0b0c0c;
  }

  .preview-image:focus {
    outline: 3px solid #fd0;
    outline-offset: 0;
    box-shadow: 0 0 0 3px #fd0;
  }

  .image-wrapper {
    position: relative;
    text-align: center;
    min-height: 300px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .image-wrapper::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: radial-gradient(circle at var(--mouse-x, 50%) var(--mouse-y, 50%),
        transparent 0%,
        transparent 15%,
        rgba(0, 0, 0, 0.02) 25%,
        rgba(0, 0, 0, 0.08) 45%,
        rgba(0, 0, 0, 0.15) 100%);
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.2s ease-in-out;
    z-index: 5;
    border-radius: 8px;
  }

  .image-wrapper:hover::before {
    opacity: 1;
  }

  /* Reduce motion for users who prefer it */
  @media (prefers-reduced-motion: reduce) {
    .image-wrapper::before {
      transition: none;
    }
  }

  .image-wrapper::after {
    content: '';
    position: absolute;
    width: 32px;
    height: 32px;
    border: 2px solid #fd0;
    border-radius: 50%;
    background: rgba(253, 0, 0, 0.1);
    box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.9), 0 0 0 3px rgba(253, 0, 0, 0.3);
    transform: translate(-50%, -50%);
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.2s ease-in-out, transform 0.2s ease-in-out;
    z-index: 6;
    left: var(--mouse-x, 50%);
    top: var(--mouse-y, 50%);
  }

  .image-wrapper:hover::after {
    opacity: 1;
    transform: translate(-50%, -50%) scale(1.1);
  }

  .preview-image:focus+.image-wrapper::before,
  .preview-image:focus+.image-wrapper::after {
    opacity: 1;
  }

  .preview-image:focus+.image-wrapper::after {
    left: 50%;
    top: 50%;
    transform: translate(-50%, -50%) scale(1.2);
  }

  /* Reduce motion for users who prefer it */
  @media (prefers-reduced-motion: reduce) {
    .image-wrapper::after {
      transition: none;
    }

    .image-wrapper:hover::after,
    .preview-image:focus+.image-wrapper::after {
      transform: translate(-50%, -50%);
    }
  }
</style>
{% endblock %}

{% from "components/service-header/macro.njk" import serviceHeader %}
{% from "side-navigation/macro.njk" import dwpSideNavigation %}
{% from "govuk/components/table/macro.njk" import govukTable %}
{% from "govuk/components/tabs/macro.njk" import govukTabs %}

{% macro imagePreview(imageData) %}
<div class="preview-section">
  <span class="govuk-caption-m govuk-!-margin-bottom-1">{{ imageData.previewLabel | default("Preview") }}</span>
  <div class="image-container govuk-!-margin-bottom-6" role="region"
    aria-labelledby="image-heading-{{ loop.index | default(1) }}">
    <h2 id="image-heading-{{ loop.index | default(1) }}" class="govuk-visually-hidden">Preview of the image</h2>
    <div class="image-wrapper">
      <img src="{{ imageData.src }}" alt="{{ imageData.alt }}" class="preview-image"
        style="max-width: 100%; height: auto; display: block;" tabindex="0">
    </div>
    <div class="image-controls" role="navigation" aria-label="Image controls">
      <button class="image-tab zoom-out-button" type="button" aria-label="Zoom out" title="Zoom out" tabindex="0">
        −
      </button>
      <button class="image-tab zoom-in-button" type="button" aria-label="Zoom in" title="Zoom in" tabindex="0">
        +
      </button>
      <button class="image-tab reset-zoom-button" type="button" aria-label="Reset zoom" title="Reset zoom" tabindex="0">
        ⌂
      </button>
      <button class="image-tab maximise-button" type="button" aria-label="Maximise image" title="Maximise image"
        tabindex="0">
        ⛶
      </button>
    </div>
    <div class="zoom-info" aria-live="polite" aria-atomic="true">
      <span class="govuk-body-s" style="color: white;">Zoom: <span class="zoom-level">100%</span></span>
    </div>
  </div>
  {% if imageData.caption %}
  <div class="markdown-content govuk-caption-m govuk-!-margin-bottom-1 govuk-!-margin-top-1"
    data-markdown="{{ imageData.caption | replace('"', ' &quot;') | replace('\n', '\\n' ) }}"></div>
  {% endif %}
</div>
{% endmacro %}

{% set pageName = "Forms Designer prototypes" %}

{% set features = [
{
name: "Save and exit",
problem: "Users need to save and come back to a form later.",
status: "Tested",
statusClass: "green",
phase: "Private beta",
type: "Public journeys",
category: "Public journeys",
designHistoryHref: "",
researchRounds: [
{ round: 7, date: "Oct 2024" },
{ round: 8, date: "Nov 2024" },
{ round: 9, date: "Mar 2025" },
{ round: 10, date: "Mar 2025" }
]
},
{
name: "Page sections",
problem: "Users need to organise how information is presented on check your answers pages.",
status: "Tested",
statusClass: "green",
phase: "Private beta",
type: "Form structure",
category: "Form editor",
designHistoryHref: "",
researchRounds: [
{ round: 7, date: "Oct 2024" },
{ round: 8, date: "Nov 2024" },
{ round: 9, date: "Mar 2025" },
{ round: 10, date: "Mar 2025" }
]
},
{
name: "Precise location questions",
problem: "Users need to ask for location information other than address lines, such as coordinates and grid
references.",
status: "In progress",
statusClass: "orange",
phase: "Private beta",
type: "Question types",
category: "Form editor",
designHistoryHref: "",
researchRounds: [
{ round: 11, date: "" }
]
},

{

name: "Confirmation emails",
problem: "Users need reassurance they their form has been submitted.",
status: "Tested",
statusClass: "green",
phase: "Private beta",
type: "Public journeys",
category: "Public journeys",
designHistoryHref: "",
researchRounds: [
{ round: 7, date: "" }
]
},
{
name: "Form history",
problem: "Users need to see a history of their form and policy requires this.",
status: "Tested",
statusClass: "green",
phase: "Private beta",
type: "Form structure",
category: "Form overview",
designHistoryHref: "",
researchRounds: [
{ round: 7, date: "Oct 2024" },
{ round: 8, date: "Nov 2024" },
{ round: 9, date: "Mar 2025" },
{ round: 10, date: "Mar 2025" }
]
},
{
name: "Machine readable submission data",
problem: "Users need to be able to choose the data they want to send to their systems.",
status: "In progress",
statusClass: "orange",
phase: "Private beta",
type: "Form management",
category: "Form management",
designHistoryHref: "",
researchRounds: [
{ round: 7, date: "Oct 2024" },
{ round: 8, date: "Nov 2024" },
{ round: 9, date: "Mar 2025" },
{ round: 10, date: "Mar 2025" }
]
},
{
name: "Declaration page",
problem: "Users need to ask for a declaration before submitting a form.",
status: "Tested",
statusClass: "green",
phase: "Private beta",
type: "Question types",
category: "Form editor",
designHistoryHref: "",
researchRounds: [
{ round: 7, date: "Oct 2024" },
{ round: 8, date: "Nov 2024" },
{ round: 9, date: "Mar 2025" },
{ round: 10, date: "Mar 2025" }
]
},
{
name: "List items",
problem: "Users need to create lists of options",
status: "Tested",
statusClass: "green",
phase: "Private beta",
type: "Question types",
category: "Form editor",
designHistoryHref: "/design-history/lists/index.html",
researchRounds: [
{ round: 7, date: "Oct 2024" },
{ round: 8, date: "Nov 2024" },
{ round: 9, date: "Mar 2025" },
{ round: 10, date: "Mar 2025" }
]
},
{
name: "Form overview",
problem: "Users need to be able to manage their forms",
status: "Tested",
statusClass: "green",
phase: "Private beta",
type: "Form structure",
category: "Form overview",
designHistoryHref: "/design-history/form-overview/index.html",
researchRounds: [
{ round: 1, date: "May 2024" },
{ round: 2, date: "Jun 2024" },
{ round: 3, date: "Jun 2024" },
{ round: 4, date: "Jul 2024" }
]
},
{
name: "Conditions (page conditions)",
problem: "Users need to show different pages based on responses",
status: "Tested",
statusClass: "green",
phase: "Private beta",
type: "Form logic",
category: "Form editor",
designHistoryHref: "/design-history/page-conditions/index.html",
researchRounds: [
{ round: 2, date: "Jun 2024" },
{ round: 11, date: "Mar 2025" },
{ round: 12, date: "Mar 2025" },
{ round: 13, date: "Apr 2025" }
]
},
{
name: "Create new form (overall journey)",
problem: "Users need a clear process for creating and managing forms",
status: "Tested",
statusClass: "green",
phase: "Private beta",
type: "Form management",
category: "Form creation",
designHistoryHref: "/design-history/form-creation/index.html",
researchRounds: [
{ round: 1, date: "May 2024" },
{ round: 3, date: "Jun 2024" },
{ round: 4, date: "Jul 2024" },
{ round: 7, date: "Oct 2024" }
]
},
{
name: "'Add another' pattern (repeaters)",
problem: "Users need to ask the same question multiple times",
status: "Tested",
statusClass: "green",
phase: "Private beta",
type: "Question types",
category: "Form editor",
designHistoryHref: "/design-history/add-another/index.html",
researchRounds: [
{ round: 5, date: "Jul 2024" },
{ round: 6, date: "Sep 2024" },
{ round: 7, date: "Oct 2024" },
{ round: 9, date: "Mar 2025" }
]
},
{
name: "Guidance pages (includes page heading)",
problem: "Users need to provide clear instructions and context",
status: "Tested",
statusClass: "green",
phase: "Private beta",
type: "Form structure",
category: "Form editor",
designHistoryHref: "",
researchRounds: [
{ round: 1, date: "May 2024" },
{ round: 6, date: "Sep 2024" },
{ round: 8, date: "Nov 2024" }
]
},
{
name: "Forms library (sorting, filtering, tags)",
problem: "Users need to efficiently find and manage their forms",
status: "Tested",
statusClass: "green",
phase: "Private beta",
type: "Form management",
category: "Form library",
designHistoryHref: "/design-history/form-library/index.html",
researchRounds: [
{ round: 1, date: "May 2024" },
{ round: 3, date: "Jun 2024" },
{ round: 4, date: "Jul 2024" },
{ round: 5, date: "Jul 2024" }
]
},
{
name: "File upload (citizen view, internal, supporting evidence)",
problem: "Users need to allow file uploads and manage supporting evidence",
status: "Tested",
statusClass: "green",
phase: "Private beta",
type: "Question types",
category: "Form editor",
designHistoryHref: "/design-history/file-upload/index.html",
researchRounds: [
{ round: 3, date: "Jun 2024" },
{ round: 4, date: "Jul 2024" },
{ round: 7, date: "Oct 2024" },
{ round: 8, date: "Nov 2024" }
]
},
{
name: "Preview panel",
problem: "Users need to see how their form will look",
status: "Tested",
statusClass: "green",
phase: "Private beta",
type: "Form preview",
category: "Form editor",
designHistoryHref: "/design-history/preview-panel/index.html",
researchRounds: [
{ round: 7, date: "Oct 2024" },
{ round: 8, date: "Nov 2024" },
{ round: 12, date: "Mar 2025" }
]
},
{
name: "Short description for error messages",
problem: "Users need to provide clear error messages",
status: "Tested",
statusClass: "green",
phase: "Private beta",
type: "Form validation",
category: "Form editor",
designHistoryHref: "/design-history/short-description/index.html",
researchRounds: [
{ round: 7, date: "Oct 2024" },
{ round: 8, date: "Nov 2024" }
]
},
{
name: "Support pages",
problem: "Users need to add supporting information to their forms",
status: "Tested",
statusClass: "green",
phase: "Private beta",
type: "Form structure",
category: "Form overview",
designHistoryHref: "",
researchRounds: [
{ round: 2, date: "Jun 2024" }
]
},
{
name: "Page sections",
problem: "Users need to organize forms into logical sections",
status: "Tested",
statusClass: "green",
phase: "Private beta",
type: "Form structure",
category: "Form editor",
designHistoryHref: "/design-history/sections/index.html",
researchRounds: [
{ round: 13, date: "Apr 2025" }
]
},
{
name: "Importing/exporting forms",
problem: "Users need to share and reuse form designs",
status: "Tested",
statusClass: "green",
phase: "Private beta",
type: "Form management",
category: "Form editor",
designHistoryHref: "/design-history/importing-exporting/index.html",
researchRounds: [
{ round: 11, date: "Mar 2025" }
]
}
] %}

{% set sortedFeatures = features|sort(attribute='status', reverse=true) %}
{% set groupedFeatures = sortedFeatures|groupby('category') %}

{% block header %}
{{ serviceHeader({
organisationName: "Defra",
productName: "Forms Designer",
serviceName: "Design history",
accountName: "Account",
containerClasses: containerClasses,
homepageLink: "/design-system/components.html",
navigationItems: [
{ href: "/library", text: "Prototypes", id: "prototype" },
{ href: "/design-system/components.html", text: "Components", id: "components" },
{ href: "/design-system/user-journeys/home.html", text: "User journeys", id: "user-journeys" }
],
activeLinkId: "prototype"
}) }}

{{ xGovukMasthead({
title: {
text: "Forms Designer prototypes"
},
description: {
html: 'This page shows prototypes for the Defra Forms Designer (DxT). You can see the current status and features of
different versions of the tool.'
},
startButton: {
href: "/titan-mvp-1.2/choose.html",
text: "Start latest prototype (Titan MVP 1.2)"
}
}) }}

{% endblock %}

{% block content %}
<div class="govuk-grid-row">
  <div class="govuk-grid-column-full">

    {%- from "moj/components/ticket-panel/macro.njk" import mojTicketPanel -%}

    <div class="govuk-grid-column-two-thirds">

      {{ mojTicketPanel({
      attributes: {
      "aria-label": "Read an overview of the re-design of the forms designer"
      },
      items: [{
      html: ' <h2 class="govuk-heading-m govuk-!-margin-bottom-2">Read an overview of the re-design of the forms
        designer</h2>
      <p class="govuk-body">The Defra Forms Designer (DxT) underwent a major re-design to improve usability,
        accessibility, and efficiency. Read an overview of the re-design and the changes made
        to the tool.</p>
      <a class="govuk-button govuk-!-margin-bottom-1" data-module="govuk-button"
        href="/design-history/forms-designer/index.html" target="_blank" rel="noopener noreferrer">
        Read overview
      </a>',
      attributes: {
      "aria-label": "Section 1"
      },
      classes: "moj-ticket-panel__content--green govuk-!-margin-bottom-6"
      }]
      }) }}
    </div>
    <div class="govuk-grid-column-full">

      <h2 class="govuk-heading-l">Features</h2>
      <details class="govuk-details">
        <summary class="govuk-details__summary">
          <span class="govuk-details__summary-text">
            Understanding the design process
          </span>
        </summary>
        <div class="govuk-details__text">
          <h3 class="govuk-heading-s">Understanding the design process</h3>
          <p class="govuk-body">Each feature has gone through multiple rounds of user research and testing. The design
            history link provides access to:</p>
          <ul class="govuk-list govuk-list--bullet">
            <li>Research findings and insights</li>
            <li>Design iterations and improvements</li>
            <li>User feedback and testing results</li>
            <li>Implementation decisions and rationale</li>
          </ul>
        </div>
      </details>

      {% set testedTableData = [] %}
      {% set inProgressTableData = [] %}
      {% set nextTableData = [] %}

      {% for feature in sortedFeatures %}
      {% set researchRoundsText = '' %}
      {% for round in feature.researchRounds %}
      {% if not loop.first %}{% set researchRoundsText = researchRoundsText + '<br>' %}{% endif %}
      {% set researchRoundsText = researchRoundsText + round.date + ' (Round ' + round.round + ')' %}
      {% endfor %}
      {# {% set detailsHtml = govukDetails({
      summaryText: "View rounds",
      html: researchRoundsText
      }) %} #}

      {% set designHistoryLink = '' %}
      {% if feature.designHistoryHref and feature.designHistoryHref != "" %}
      {% set designHistoryLink = '<a class="govuk-link" href="' + feature.designHistoryHref + '">View<span
          class="govuk-visually-hidden"> design history for ' + feature.name + '</span></a>' %}
      {% endif %}

      {% if feature.status == "Tested" %}
      {% set featureRow = [
      { text: feature.name },
      { text: feature.problem },
      { html: '<strong class="govuk-tag govuk-tag--' + feature.statusClass + '">' + feature.status + '</strong>' },
      { text: feature.phase },
      { text: feature.researchRounds.length + ' rounds' },

      { html: designHistoryLink }
      ] %}
      {% set testedTableData = (testedTableData.push(featureRow), testedTableData) %}
      {% elif feature.status == "Next" %}
      {% set featureRow = [
      { text: feature.name },
      { text: feature.problem },
      { html: '<strong class="govuk-tag govuk-tag--' + feature.statusClass + '">' + feature.status + '</strong>' },
      { text: feature.phase },
      { html: designHistoryLink }
      ] %}
      {% set nextTableData = (nextTableData.push(featureRow), nextTableData) %}
      {% else %}
      {% set featureRow = [
      { text: feature.name },
      { text: feature.problem },
      { html: '<strong class="govuk-tag govuk-tag--' + feature.statusClass + '">' + feature.status + '</strong>' },
      { text: feature.phase },
      { html: designHistoryLink }
      ] %}
      {% set inProgressTableData = (inProgressTableData.push(featureRow), inProgressTableData) %}
      {% endif %}
      {% endfor %}

      {% set testedCount = testedTableData | length %}
      {% set inProgressCount = inProgressTableData | length %}
      {% set nextCount = nextTableData | length %}

      {% set tabItems = [
      {
      label: "In progress (" + inProgressCount + ")",
      id: "in-progress",
      panel: {
      html: govukTable({
      attributes: { "data-module": "moj-sortable-table" },
      head: [
      { text: "Feature", attributes: { "aria-sort": "ascending" } },
      { text: "Problem statement" },
      { text: "Status" },
      { text: "Phase" },
      { text: "Design history" }
      ],
      rows: inProgressTableData
      })
      }
      }
      ] %}

      {% if nextCount >= 1 %}
      {% set tabItems = tabItems.concat([
      {
      label: "Next (" + nextCount + ")",
      id: "next",
      panel: {
      html: govukTable({
      attributes: { "data-module": "moj-sortable-table" },
      head: [
      { text: "Feature", attributes: { "aria-sort": "ascending" } },
      { text: "Problem statement" },
      { text: "Status" },
      { text: "Phase" },
      { text: "Design history" }
      ],
      rows: nextTableData
      })
      }
      }
      ]) %}
      {% endif %}

      {% set tabItems = tabItems.concat([
      {
      label: "Tested (" + testedCount + ")",
      id: "tested",
      panel: {
      html: govukTable({
      attributes: { "data-module": "moj-sortable-table" },
      head: [
      { text: "Feature", attributes: { "aria-sort": "ascending" } },
      { text: "Problem statement" },
      { text: "Status" },
      { text: "Phase" },
      { text: "Rounds" },
      { text: "Design history" }
      ],
      rows: testedTableData
      })
      }
      }
      ]) %}

      {{ govukTabs({
      items: tabItems
      }) }}
    </div>



    {# <span class="govuk-caption-m govuk-!-margin-bottom-1">Preview</span>
    <div class="iframe-container govuk-!-margin-bottom-6" role="region" aria-labelledby="preview-heading">
      <h2 id="preview-heading" class="govuk-visually-hidden">Preview of the form</h2>
      <iframe src="" class="iframe-content" style="overflow-y: auto; height: 500px; width: 100%; border: none;"
        scrolling="yes" frameborder="0" title="Form preview" marginheight="0" marginwidth="0" allowfullscreen>
      </iframe>
      <div class="iframe-tabs" role="navigation" aria-label="Preview controls">
        <a class="govuk-link govuk-link--no-visited-state iframe-tab maximise-button"
          style="border-right: #007f3b 1px solid;" href="#" role="button" aria-label="Maximise preview"
          title="Maximise preview" tabindex="0">
          Maximise
        </a>
        <a class="govuk-link govuk-link--no-visited-state iframe-tab" href="" target="_blank" rel="noopener noreferrer"
          aria-label="Open preview in a new tab" title="Open preview in a new tab">
          Open in a new tab
        </a>
      </div>
    </div> #}

    <div class="govuk-grid-column-full govuk-grid-column-full-from-desktop">
      {{ imagePreview({
      src: "public/images/onboarding.svg",
      alt: "Screenshot of the Forms Designer onboarding interface showing user introduction, getting started guide, and
      initial setup process",
      previewLabel: "Forms Designer Overview",
      caption: ""
      }) }}

      {{ imagePreview({
      src: "public/images/form-creation.svg",
      alt: "Screenshot of the Forms Designer interface showing the form creation workflow with drag-and-drop components,
      form fields, and preview panel",
      previewLabel: "Forms Designer Overview",
      caption: ""
      }) }}

      {{ imagePreview({
      src: "public/images/runner.svg",
      alt: "Screenshot of the Forms Designer runner interface showing form execution, user journey flow, and interactive
      form elements",
      previewLabel: "Forms Designer Overview",
      caption: ""
      }) }}
    </div>

    {#
    <div class="govuk-grid-column-full govuk-grid-column-two-thirds-from-desktop">
      <h2 class="govuk-heading-l govuk-!-margin-top-6">Design System</h2>
      <p class="govuk-body">
        Explore our <a class="govuk-link--no-visited-state" href="/design-system/components.html">design system
          components</a> and <a class="govuk-link--no-visited-state" href="/design-system/user-journeys/home.html">user
          journeys</a>.
      </p>

      <hr class="govuk-section-break govuk-section-break--xl govuk-section-break--visible">

      <h2 class="govuk-heading-l">Documentation</h2>
      <h3 class="govuk-heading-m">Editor Components</h3>
      <p class="govuk-body"><a class="govuk-link--no-visited-state"
          href="/design-system/editor/configuration-panel.html">Configuration panels</a></p>
      <p class="govuk-body"><a class="govuk-link--no-visited-state"
          href="/design-system/editor/guided-input.html">Guided
          input</a></p>
      <p class="govuk-body"><a class="govuk-link--no-visited-state"
          href="/design-system/editor/preview-panel.html">Preview panels</a></p>

      <h3 class="govuk-heading-m">Form Management</h3>
      <p class="govuk-body"><a class="govuk-link--no-visited-state" href="/design-system/reordering/pages.html">Page
          reordering</a></p>
      <p class="govuk-body"><a class="govuk-link--no-visited-state"
          href="/design-system/reordering/questions.html">Question reordering</a></p>
      <p class="govuk-body"><a class="govuk-link--no-visited-state" href="/design-system/deletion/pages.html">Page
          deletion</a></p>
    </div>
  </div> #}



  {% endblock %}

  {% block pageScripts %}
  <script src="/public/javascripts/moj-sortable-table.js"></script>
  <script>
    // Image preview functionality
    document.addEventListener('DOMContentLoaded', function () {
      const maximiseButtons = document.querySelectorAll('.maximise-button');
      const zoomInButtons = document.querySelectorAll('.zoom-in-button');
      const zoomOutButtons = document.querySelectorAll('.zoom-out-button');
      const resetZoomButtons = document.querySelectorAll('.reset-zoom-button');

      // Maximize/minimize functionality
      maximiseButtons.forEach(function (button) {
        button.addEventListener('click', function (event) {
          event.preventDefault();

          const imageContainer = button.closest('.image-container');
          const image = imageContainer.querySelector('.preview-image');

          // Toggle fullscreen mode
          if (imageContainer.classList.contains('fullscreen')) {
            imageContainer.classList.remove('fullscreen');
            button.textContent = '⛶';
            button.setAttribute('aria-label', 'Maximise image');
            button.setAttribute('title', 'Maximise image');
            // Reset zoom when exiting fullscreen
            resetImageZoom(image);
          } else {
            imageContainer.classList.add('fullscreen');
            button.textContent = '✕';
            button.setAttribute('aria-label', 'Exit fullscreen');
            button.setAttribute('title', 'Exit fullscreen');
          }
        });
      });


      // Zoom in functionality
      zoomInButtons.forEach(function (button) {
        button.addEventListener('click', function (event) {
          event.preventDefault();
          const imageContainer = button.closest('.image-container');
          const image = imageContainer.querySelector('.preview-image');
          zoomImage(image, 1.2);
        });
      });

      // Zoom out functionality
      zoomOutButtons.forEach(function (button) {
        button.addEventListener('click', function (event) {
          event.preventDefault();
          const imageContainer = button.closest('.image-container');
          const image = imageContainer.querySelector('.preview-image');
          zoomImage(image, 0.8);
        });
      });

      // Reset zoom functionality
      resetZoomButtons.forEach(function (button) {
        button.addEventListener('click', function (event) {
          event.preventDefault();
          const imageContainer = button.closest('.image-container');
          const image = imageContainer.querySelector('.preview-image');
          resetImageZoom(image);
        });
      });

      // Keyboard navigation
      document.addEventListener('keydown', function (event) {
        const focusedImage = document.querySelector('.preview-image:focus');
        if (!focusedImage) return;

        const imageContainer = focusedImage.closest('.image-container');
        const zoomLevel = focusedImage.dataset.zoomLevel || 1;

        // Only handle zoom keys when image is focused and no modifier keys
        if (!event.ctrlKey && !event.metaKey) {
          switch (event.key) {
            case '+':
            case '=':
              event.preventDefault();
              event.stopPropagation();
              zoomImage(focusedImage, 1.2);
              break;
            case '-':
              event.preventDefault();
              event.stopPropagation();
              zoomImage(focusedImage, 0.8);
              break;
            case '0':
              event.preventDefault();
              event.stopPropagation();
              resetImageZoom(focusedImage);
              break;
            case 'ArrowUp':
              event.preventDefault();
              event.stopPropagation();
              panImage(focusedImage, 0, -20);
              break;
            case 'ArrowDown':
              event.preventDefault();
              event.stopPropagation();
              panImage(focusedImage, 0, 20);
              break;
            case 'ArrowLeft':
              event.preventDefault();
              event.stopPropagation();
              panImage(focusedImage, -20, 0);
              break;
            case 'ArrowRight':
              event.preventDefault();
              event.stopPropagation();
              panImage(focusedImage, 20, 0);
              break;
          }
        }
      });

      // Mouse wheel zoom
      document.addEventListener('wheel', function (event) {
        const focusedImage = document.querySelector('.preview-image:focus');
        if (!focusedImage) return;

        if (event.ctrlKey || event.metaKey) {
          event.preventDefault();
          const zoomFactor = event.deltaY > 0 ? 0.9 : 1.1;
          zoomImage(focusedImage, zoomFactor);
        }
      });

      // Double-click to zoom in
      document.addEventListener('dblclick', function (event) {
        const focusedImage = document.querySelector('.preview-image:focus');
        if (!focusedImage) return;

        event.preventDefault();
        const zoomFactor = 1.5;
        zoomImage(focusedImage, zoomFactor);
      });


      // Mouse drag to pan
      let isDragging = false;
      let draggedImage = null;
      let startX, startY, startTransformX, startTransformY;

      document.addEventListener('mousedown', function (event) {
        if (event.target.classList.contains('preview-image')) {
          const image = event.target;
          const zoomLevel = parseFloat(image.dataset.zoomLevel || 1);

          if (zoomLevel > 1) {
            isDragging = true;
            draggedImage = image;
            startX = event.clientX;
            startY = event.clientY;

            const transform = image.style.transform;
            const match = transform.match(/translate\(([^,]+),\s*([^)]+)\)/);
            startTransformX = match ? parseFloat(match[1]) : 0;
            startTransformY = match ? parseFloat(match[2]) : 0;

            image.closest('.image-wrapper').classList.add('panning');
            image.style.cursor = 'grabbing';
            event.preventDefault();
          }
        }
      });

      // Consolidated mousemove handler for both position tracking and dragging
      document.addEventListener('mousemove', function (event) {
        // Handle dragging functionality
        if (isDragging && draggedImage) {
          const deltaX = event.clientX - startX;
          const deltaY = event.clientY - startY;

          // Reduce sensitivity by dividing by 2
          const newX = startTransformX + (deltaX / 2);
          const newY = startTransformY + (deltaY / 2);

          const currentZoom = parseFloat(draggedImage.dataset.zoomLevel || 1);
          draggedImage.style.transform = `scale(${currentZoom}) translate(${newX}px, ${newY}px)`;
        }

        // Handle mouse position tracking for focus indicator
        const imageWrappers = document.querySelectorAll('.image-wrapper');
        imageWrappers.forEach(function (wrapper) {
          const rect = wrapper.getBoundingClientRect();
          const x = ((event.clientX - rect.left) / rect.width) * 100;
          const y = ((event.clientY - rect.top) / rect.height) * 100;
          wrapper.style.setProperty('--mouse-x', x + '%');
          wrapper.style.setProperty('--mouse-y', y + '%');
        });
      });

      document.addEventListener('mouseup', function () {
        if (isDragging) {
          isDragging = false;
          if (draggedImage) {
            draggedImage.style.cursor = 'grab';
            draggedImage.closest('.image-wrapper').classList.remove('panning');
            draggedImage = null;
          }
        }
      });

      // Touch support for mobile devices
      let touchStartX, touchStartY, touchStartTransformX, touchStartTransformY;

      document.addEventListener('touchstart', function (event) {
        if (event.target.classList.contains('preview-image')) {
          const image = event.target;
          const zoomLevel = parseFloat(image.dataset.zoomLevel || 1);

          if (zoomLevel > 1 && event.touches.length === 1) {
            isDragging = true;
            draggedImage = image;
            touchStartX = event.touches[0].clientX;
            touchStartY = event.touches[0].clientY;

            const transform = image.style.transform;
            const match = transform.match(/translate\(([^,]+),\s*([^)]+)\)/);
            touchStartTransformX = match ? parseFloat(match[1]) : 0;
            touchStartTransformY = match ? parseFloat(match[2]) : 0;

            image.closest('.image-wrapper').classList.add('panning');
            event.preventDefault();
          }
        }
      });

      document.addEventListener('touchmove', function (event) {
        if (isDragging && draggedImage && event.touches.length === 1) {
          const deltaX = event.touches[0].clientX - touchStartX;
          const deltaY = event.touches[0].clientY - touchStartY;

          // Reduce sensitivity by dividing by 2
          const newX = touchStartTransformX + (deltaX / 2);
          const newY = touchStartTransformY + (deltaY / 2);

          const currentZoom = parseFloat(draggedImage.dataset.zoomLevel || 1);
          draggedImage.style.transform = `scale(${currentZoom}) translate(${newX}px, ${newY}px)`;
          event.preventDefault();
        }
      });

      document.addEventListener('touchend', function () {
        if (isDragging) {
          isDragging = false;
          if (draggedImage) {
            draggedImage.closest('.image-wrapper').classList.remove('panning');
            draggedImage = null;
          }
        }
      });

      // Helper functions
      function zoomImage(image, factor) {
        const currentZoom = parseFloat(image.dataset.zoomLevel || 1);
        const newZoom = Math.max(0.1, Math.min(5, currentZoom * factor));

        image.dataset.zoomLevel = newZoom;
        image.classList.add('zoomed');

        const currentTransform = image.style.transform;
        const translateMatch = currentTransform.match(/translate\(([^,]+),\s*([^)]+)\)/);
        const translateX = translateMatch ? translateMatch[1] : '0px';
        const translateY = translateMatch ? translateMatch[2] : '0px';

        image.style.transform = `scale(${newZoom}) translate(${translateX}, ${translateY})`;

        // Update zoom level display
        const zoomLevelElement = image.closest('.image-container').querySelector('.zoom-level');
        if (zoomLevelElement) {
          zoomLevelElement.textContent = Math.round(newZoom * 100) + '%';
        }
      }

      function resetImageZoom(image) {
        image.dataset.zoomLevel = 1;
        image.classList.remove('zoomed');
        image.style.transform = 'scale(1) translate(0px, 0px)';

        // Update zoom level display
        const zoomLevelElement = image.closest('.image-container').querySelector('.zoom-level');
        if (zoomLevelElement) {
          zoomLevelElement.textContent = '100%';
        }
      }

      function panImage(image, deltaX, deltaY) {
        const currentTransform = image.style.transform;
        const zoomMatch = currentTransform.match(/scale\(([^)]+)\)/);
        const translateMatch = currentTransform.match(/translate\(([^,]+),\s*([^)]+)\)/);

        const currentZoom = zoomMatch ? parseFloat(zoomMatch[1]) : 1;
        const currentX = translateMatch ? parseFloat(translateMatch[1]) : 0;
        const currentY = translateMatch ? parseFloat(translateMatch[2]) : 0;

        const newX = currentX + deltaX;
        const newY = currentY + deltaY;

        image.style.transform = `scale(${currentZoom}) translate(${newX}px, ${newY}px)`;
      }

      // Table sorting functionality
      // Initial sort (with safety check to prevent multiple calls)
      if (typeof window.tableSortInitialized === 'undefined') {
        window.tableSortInitialized = true;
        sortTableByRecentDate();
      }

      // Override the click handler for sortable columns
      const sortableHeaders = document.querySelectorAll('.govuk-table__header[aria-sort]');
      sortableHeaders.forEach(header => {
        header.addEventListener('click', (e) => {
          e.preventDefault();
          const table = header.closest('.govuk-table');
          const tbody = table.querySelector('tbody');
          const rows = Array.from(tbody.querySelectorAll('tr'));

          // Get the column index
          const columnIndex = Array.from(header.parentElement.children).indexOf(header);

          // Sort rows by the clicked column
          rows.sort((a, b) => {
            const cellA = a.children[columnIndex];
            const cellB = b.children[columnIndex];
            const valueA = cellA.textContent.trim();
            const valueB = cellB.textContent.trim();
            return valueA.localeCompare(valueB);
          });

          // Re-append rows in sorted order
          rows.forEach(row => tbody.appendChild(row));
        });
      });
    });
  </script>
  <script>
    // Helper to extract all dates from a string and return the most recent one
    function getMostRecentDate(detailsText) {
      const monthMap = {
        'Jan': 0, 'Feb': 1, 'Mar': 2, 'Apr': 3, 'May': 4, 'Jun': 5,
        'Jul': 6, 'Aug': 7, 'Sep': 8, 'Oct': 9, 'Nov': 10, 'Dec': 11
      };

      // Use matchAll instead of exec to avoid infinite loops
      const dateRegex = /([A-Za-z]+) (\d{4})/g;
      const matches = detailsText.matchAll(dateRegex);
      let maxDate = new Date(0);

      for (const match of matches) {
        const month = match[1];
        const year = parseInt(match[2]);
        if (monthMap[month] !== undefined) {
          const d = new Date(year, monthMap[month], 1);
          if (d > maxDate) maxDate = d;
        }
      }
      return maxDate;
    }

    // Sort table rows by most recent research round date (for tested features)
    function sortTableByRecentDate() {
      try {
        const tables = document.querySelectorAll('.govuk-table')
        tables.forEach(table => {
          const tbody = table.querySelector('tbody')
          if (!tbody) return; // Safety check

          const rows = Array.from(tbody.querySelectorAll('tr'))
          if (rows.length === 0) return; // Safety check

          // Sort rows by most recent research round date
          rows.sort((a, b) => {
            try {
              const detailsA = a.querySelector('.govuk-details__text')
              const detailsB = b.querySelector('.govuk-details__text')

              if (detailsA && detailsB) {
                const maxDateA = getMostRecentDate(detailsA.textContent || '')
                const maxDateB = getMostRecentDate(detailsB.textContent || '')
                return maxDateB - maxDateA
              }

              return 0
            } catch (error) {
              console.warn('Error sorting table row:', error)
              return 0
            }
          })

          // Re-append rows in sorted order
          rows.forEach(row => {
            try {
              tbody.appendChild(row)
            } catch (error) {
              console.warn('Error appending table row:', error)
            }
          })
        })
      } catch (error) {
        console.warn('Error in sortTableByRecentDate:', error)
      }
    }

  </script>
  {% endblock %}

  {
  name: "OTP Input Component",
  problem: "Users need to enter verification codes, PINs, and other one-time passwords with smart focus management.",
  status: "Demo",
  statusClass: "green",
  phase: "Prototype",
  type: "Question types",
  category: "Form editor",
  designHistoryHref: "",
  researchRounds: [],
  demoHref: "/titan-mvp-1.2/govuk-otp-input-demo"
  },
  {
  name: "OTP Input for Coordinates",
  problem: "Users need to enter precise coordinate data with smart focus management and paste functionality.",
  status: "Demo",
  statusClass: "green",
  phase: "Prototype",
  type: "Question types",
  category: "Form editor",
  designHistoryHref: "",
  researchRounds: [],
  demoHref: "/titan-mvp-1.2/form-editor/location/wreck-otp"
  },