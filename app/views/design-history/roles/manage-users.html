{% extends "layouts/main.html" %}

{% from "components/service-header/macro.njk" import serviceHeader %}
{% from "govuk/components/summary-list/macro.njk" import govukSummaryList %}
{% from "govuk/components/notification-banner/macro.njk" import govukNotificationBanner %}
{%- from "govuk/components/table/macro.njk" import govukTable -%}

{% set pageName = "Manage users" %}

{% block header %}
{{ serviceHeader({
organisationName: "Defra",
productName: "Forms Designer",
serviceName: "",
accountName: "Chris Smith",
homepageLink: "/",
signOutLink: "/titan-mvp-1.2/onboarding/sign-out-confirmation",
navigationItems: [
{ href: "/titan-mvp-1.2/library", text: "Forms library", id: "nav-library" },
{ href: "/titan-mvp-1.2/roles/my-account.html", text: "My account", id: "my-account" },
{ href: "/titan-mvp-1.2/roles/manage-users.html", text: "Manage users", id: "manage-users", active: true }
]
}) }}
{% endblock %}

{% block beforeContent %}
{{ govukBackLink({
text: "Back to forms library",
href: "/titan-mvp-1.2/library"
}) }}
{% endblock %}

{% block content %}
<div class="govuk-grid-row">
    <div class="govuk-grid-column-full">
        <h1 class="govuk-heading-xl">Manage users</h1>

        <form action="/titan-mvp-1.2/roles/add-new-user" method="GET" novalidate>
            {{ govukButton({
            text: "Add new user",
            classes: "govuk-button--secondary"
            }) }}
        </form>

        {% if data.successMessage %}
        {{ govukNotificationBanner({
        type: "success",
        html: data.successMessage
        }) }}
        {% endif %}

        {% if data.users and data.users.length > 0 %}
        {% set rows = [] %}
        {% for user in data.users %}
        {% set rows = (rows.push([
        {
        html: '<span class="govuk-visually-hidden">User: </span>' + user.semanticName + '<br><span class="govuk-hint"
            aria-hidden="true">' + user.email + '</span><span class="govuk-visually-hidden">Email: ' + user.email +
            '</span>',
        attributes: {
        "data-sort-value": user.semanticName
        },
        classes: ""
        },
        {
        text: user.role | capitalize,
        attributes: {
        "data-sort-value": user.role
        },
        classes: ""
        },
        {
        html: '<a href="/titan-mvp-1.2/roles/edit-user.html?email=' + user.email + '"
            class="govuk-link govuk-link--no-visited-state">Manage<span class="govuk-visually-hidden"> user ' +
                user.semanticName + '</span></a>',
        classes: ""
        }
        ]), rows) %}
        {% endfor %}

        {{ govukTable({
        attributes: {
        "data-module": "moj-sortable-table"
        },
        caption: "Users",
        captionClasses: "govuk-table__caption--m",
        firstCellIsHeader: false,
        head: [
        {
        text: "Name",
        attributes: {
        "aria-sort": "ascending",
        "scope": "col"
        }
        },
        {
        text: "Role",
        attributes: {
        "aria-sort": "none",
        "scope": "col"
        }
        },
        {
        text: "Actions",
        scope: "col"
        }
        ],
        rows: rows
        }) }}
        {% else %}
        <p class="govuk-body">No users found.</p>
        {% endif %}
    </div>
</div>
{% endblock %}