{% extends "layouts/main.html" %}

{% from "components/service-header/macro.njk" import serviceHeader %}
{% from "govuk/components/button/macro.njk" import govukButton %}
{% from "govuk/components/radios/macro.njk" import govukRadios %}

{% set pageName = "Reference Links Task" %}

{% block header %}
{{ serviceHeader({
organisationName: "Defra",
productName: "Forms designer",
serviceName: "",
accountName: "Chris Smith",
homepageLink: "/",
signOutLink: "/titan-mvp-1.2/onboarding/sign-out-confirmation",
navigationItems: [{
href: "/titan-mvp-1.2/library",
text: "Library",
id: "titan-mvp-1.2/library"
}]
}) }}

<div class="x-govuk-masthead x-govuk-masthead--large">
    <div class="govuk-width-container">
        {{ govukBackLink({
        classes: "govuk-back-link--inverse govuk-!-margin-bottom-0",
        text: "Back to task list",
        href: "/titan-mvp-1.2/ai/tasklist-form-creation"
        }) }}

        <hr class="govuk-section-break govuk-section-break--m govuk-section-break--visible"
            style="border-bottom: 1px solid white; margin-bottom: 0" />

        <div class="govuk-grid-row">
            <div class="govuk-grid-column-full-from-desktop">
                <h1 class="x-govuk-masthead__title">
                    <span class="govuk-caption-l" style="color: white;">AI form creation
                    </span>
                    Reference links
                </h1>
                {# <p class="x-govuk-masthead__description">
                    Provide links to similar forms, guidance documents, or examples that can help the AI understand your
                    requirements and provide better suggestions.
                </p> #}

            </div>

        </div>
    </div>
</div>
{% endblock %}

{% block content %}
<div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds">



        <form class="form" action="/titan-mvp-1.2/ai/task/reference-links" method="post">

            {{ govukTextarea({
            id: "reference-links",
            name: "referenceLinks",
            label: {
            text: "Add links to similar forms, guidance documents, or examples",
            classes: "govuk-label--m",
            isPageHeading: false
            },
            hint: {
            text: "One link per line"
            },
            rows: 8,
            value: data.referenceLinks
            }) }}

            {{ govukDetails({
            summaryText: "What to include and examples",
            html: "
            <h3 class='govuk-heading-s'>Consider adding links to:</h3>
            <ul class='govuk-list govuk-list--bullet'>
                <li>Similar forms in your organization</li>
                <li>Government guidance documents</li>
                <li>Industry best practice examples</li>
                <li>Design system documentation</li>
                <li>User research findings</li>
            </ul>

            <h3 class='govuk-heading-s govuk-!-margin-top-4'>Example references:</h3>
            <p class='govuk-body'>https://www.gov.uk/example-form</p>
            <p class='govuk-body'>https://design-system.service.gov.uk/patterns/</p>
            <p class='govuk-body'>https://www.gov.uk/guidance/form-design</p>
            "
            }) }}

            <div class="govuk-!-margin-top-6">
                {{ govukRadios({
                name: "haveYouCompletedThisSection",
                fieldset: {
                legend: {
                text: "Have you completed this section?",
                isPageHeading: false,
                classes: "govuk-fieldset__legend--m"
                }
                },
                items: [
                {
                value: "yes",
                text: "Yes, I've completed this section"
                },
                {
                value: "no",
                text: "No, I'll come back to it later"
                }
                ]
                }) }}

                <div class="govuk-button-group">
                    {{ govukButton({
                    text: "Continue",
                    classes: "govuk-button"
                    }) }}
                </div>
            </div>

        </form>
    </div>


</div>

<style>
    .govuk-sticky {
        position: sticky;
        top: 20px;
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Handle form submission based on radio selection
        const form = document.querySelector('form');
        const continueButton = document.querySelector('button[type="submit"]');

        continueButton.addEventListener('click', function (e) {
            e.preventDefault();

            const selectedOption = document.querySelector('input[name="haveYouCompletedThisSection"]:checked');

            if (selectedOption && selectedOption.value === 'no') {
                // If "No, I'll come back to it later" is selected, save as incomplete and redirect
                const formData = new FormData(form);
                formData.append('taskStatus', 'incomplete');
                formData.append('returnToTaskList', 'true');

                // Create a temporary form to submit
                const tempForm = document.createElement('form');
                tempForm.method = 'POST';
                tempForm.action = form.action;

                for (let [key, value] of formData.entries()) {
                    const input = document.createElement('input');
                    input.type = 'hidden';
                    input.name = key;
                    input.value = value;
                    tempForm.appendChild(input);
                }

                document.body.appendChild(tempForm);
                tempForm.submit();
            } else if (selectedOption && selectedOption.value === 'yes') {
                // If "Yes, I've completed this section" is selected, save as completed
                const formData = new FormData(form);
                formData.append('taskStatus', 'completed');

                // Create a temporary form to submit
                const tempForm = document.createElement('form');
                tempForm.method = 'POST';
                tempForm.action = form.action;

                for (let [key, value] of formData.entries()) {
                    const input = document.createElement('input');
                    input.type = 'hidden';
                    input.name = key;
                    input.value = value;
                    tempForm.appendChild(input);
                }

                document.body.appendChild(tempForm);
                tempForm.submit();
            } else {
                // If no option is selected, submit the form normally
                form.submit();
            }
        });
    });
</script>
{% endblock %}