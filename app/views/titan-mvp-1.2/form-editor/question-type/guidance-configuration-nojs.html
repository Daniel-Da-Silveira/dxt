{% extends "layouts/main.html" %}
{% from "components/service-header/macro.njk" import serviceHeader %}
{% set pageName = "Edit page 1 - Apply for a county parish holding number in England" %}
{% set headingPlaceholder = "Page heading" %}
{% set guidancePlaceholder = "" %}

{% block header %}
{{ serviceHeader({
organisationName: "Defra",
productName: "Form Designer",
serviceName: "",
containerClasses: containerClasses,
accountName: "Chris Smith",
homepageLink: "/",
signOutLink: "/onboarding/sign-out-confirmation",
navigationItems: [
{ href: "/titan-mvp-1.2/library.html", text: "Forms library", id: "nav-library" },
{ href: "/cph-overview/draft/complete-clean.html", text: "Overview", id: "nav-overview" },
{ href: "/titan-mvp-1.2/form-editor/listing", text: "Editor", id: "nav-editor" } ],
activeLinkId: "nav-editor"
}) }}

<div class="x-govuk-masthead x-govuk-masthead--large">
    <div class="govuk-width-container">
        {{ govukBackLink({ classes: "govuk-back-link--inverse govuk-!-margin-bottom-0", text: "Back to add and edit
        pages", href: "/titan-mvp-1.2/form-editor/listing.html" }) }}

        <hr class="govuk-section-break govuk-section-break--m govuk-section-break--visible"
            style="border-bottom: 1px solid white; margin-bottom: 0" />

        <div class="govuk-grid-row">
            <div class="govuk-grid-column-full-from-desktop">
                <h1 class="x-govuk-masthead__title">
                    {{ form.name }}
                </h1>

                <a href="/titan-mvp-1.2/form-editor/page-type.html" role="button" draggable="false"
                    class="govuk-button govuk-button--inverse" data-module="govuk-button">
                    Add new page
                </a>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block content %}
<div class="govuk-grid-row">
    <div class="govuk-grid-column-full">
        <div class="govuk-grid-row">
            <!-- Main Content Column -->
            <div class="govuk-grid-column-one-half-from-desktop" id="container" style="flex: 1 1 75%; overflow-y: auto">
                <div class="govuk-summary-card govuk-!-margin-top-0" style="border-left: 10px solid #008938">
                    <div class="govuk-summary-card__content govuk-!-padding-top-0" style="background-color: #f3f2f1">
                        <dl class="govuk-summary-list">
                            <div class="govuk-summary-list__row">
                                <dd class="govuk-summary-list__value">
                                    <div class="govuk-grid-row" id="page-settings-container-1">
                                        <div id="question-1">
                                            <div class="govuk-summary-card__content" style="margin-bottom: 0">
                                                <nav class="moj-sub-navigation govuk-!-padding-top-0 govuk-!-margin-bottom-2"
                                                    aria-label="Sub navigation">
                                                    <ul class="moj-sub-navigation__list" id="nav-list2">
                                                        <li class="moj-sub-navigation__item">
                                                            <a class="moj-sub-navigation__link" aria-current="page"
                                                                href="#question-1">Page settings</a>
                                                        </li>
                                                        <li class="moj-sub-navigation__item">
                                                            <a class="moj-sub-navigation__link"
                                                                href="/titan-mvp-1.2/form-editor/conditions/page-level/{{ currentPage.pageId }}">
                                                                Conditions
                                                            </a>
                                                        </li>
                                                    </ul>
                                                </nav>

                                                <span class="govuk-caption-l">Page {{ pageNumber }}</span>
                                                <h1 class="govuk-heading-l">Edit guidance page</h1>

                                                <form class="form" action="/titan-mvp-1.2/form-editor/guidance/overview"
                                                    method="post">
                                                    <!-- Page Heading Input -->
                                                    {{ govukInput({
                                                    label: {
                                                    text: "Page heading",
                                                    classes: "govuk-label--m govuk-!-margin-top-0",
                                                    isPageHeading: false
                                                    },
                                                    hint: {
                                                    text: "This should be a statement, not a question. For example,
                                                    'Passport information'"
                                                    },
                                                    id: "guidance-only-page-heading-input",
                                                    name: "guidanceOnlyHeadingInput",
                                                    classes: "govuk-input",
                                                    describedBy: "page-heading-input-hint",
                                                    value: currentPage.guidanceOnlyHeadingInput or '',
                                                    attributes: {
                                                    "data-preview": "heading-preview"
                                                    }
                                                    }) }}

                                                    {{ govukTextarea({
                                                    label: {
                                                    text: "Guidance text",
                                                    classes: "govuk-label--m"
                                                    },
                                                    hint: {
                                                    text: "You can use Markdown if you want to format the content or add
                                                    links"
                                                    },
                                                    id: "guidance-only-guidance-text-input",
                                                    name: "guidanceOnlyGuidanceTextInput",
                                                    value: currentPage.guidanceOnlyGuidanceTextInput or '',
                                                    classes: "govuk-textarea",
                                                    rows: 8,
                                                    describedBy: "guidance-textarea-hint",
                                                    attributes: {
                                                    "data-preview": "guidance-preview"
                                                    }
                                                    }) }}

                                                    <details class="govuk-details">
                                                        <summary class="govuk-details__summary">
                                                            <span class="govuk-details__summary-text">
                                                                Help with markdown
                                                            </span>
                                                        </summary>
                                                        <div class="govuk-details__text">
                                                            <h3 class="govuk-heading-s">Headings and subheadings</h3>
                                                            <p class="govuk-body">Use one hash symbol followed by a
                                                                space for a heading, for example:</p>
                                                            <pre class="formatting-example"
                                                                style="background-color: white;"><code class="lang-md"># This is a heading</code></pre>
                                                            <p class="bottom-gutter-1-3">To add a subheading, use 2 hash
                                                                symbols:</p>
                                                            <pre class="formatting-example"
                                                                style="background-color: white;"><code class="lang-md">## This is a subheading</code></pre>

                                                            <h3 class="govuk-heading-s" id="bullets">Bullet points</h3>
                                                            <p class="govuk-body">Use bullet points to help words or
                                                                phrases stand out in your emails and letters.</p>
                                                            <p class="govuk-body">Copy this example to add bullet
                                                                points:</p>
                                                            <pre class="formatting-example"
                                                                style="background-color: white;"><code class="lang-md">Introduce bullet points with a lead-in line ending in a colon:

* leave one empty line space after the lead-in line
* use an asterisk or a dash followed by a space to add an item
* start each item with a lowercase letter, do not end with a full stop
* leave one empty line space after the last item</code></pre>

                                                            <h3 class="govuk-heading-s" id="bullets">Numbered steps</h3>
                                                            <p class="govuk-body">Copy this example to add numbered
                                                                steps:</p>
                                                            <pre class="formatting-example"
                                                                style="background-color: white;"><code class="lang-md">1. Leave one empty line space before starting your list.
2. Enter a number followed by a full stop and a space to add an item.
3. Start each item with a capital letter and end it with a full stop.
4. Leave one empty line space after the last item.</code></pre>

                                                            <h3 class="govuk-heading-s">Links and URLs</h3>
                                                            <p class="govuk-body">To convert text into a link, use
                                                                square brackets around the link text and round brackets
                                                                around the full URL. Make sure there are no spaces
                                                                between the brackets or the link will not work. For
                                                                example:</p>
                                                            <pre class="formatting-example"
                                                                style="background-color: white;"><code class="lang-md">[Apply now](https://www.gov.uk/example)</code></pre>
                                                        </div>
                                                    </details>

                                                    {{ govukCheckboxes({
                                                    idPrefix: "exit-page",
                                                    classes: "govuk-checkboxes--small",
                                                    name: "exitPage",
                                                    items: [
                                                    {
                                                    value: "true",
                                                    text: "Mark as Exit Page",
                                                    hint: {
                                                    text: "Users who reach this page will be unable to continue filling
                                                    out the form"
                                                    }
                                                    }
                                                    ]
                                                    }) }}

                                                    <!-- Section Selection -->
                                                    <div class="govuk-!-margin-top-6">
                                                        <div class="govuk-form-group">
                                                            <fieldset class="govuk-fieldset"
                                                                aria-describedby="section-hint">
                                                                <legend
                                                                    class="govuk-fieldset__legend govuk-fieldset__legend--m">
                                                                    Section
                                                                </legend>
                                                                <div id="section-hint" class="govuk-hint">
                                                                    You can group related pages into sections. When you
                                                                    add a section to a page, a caption appears above the
                                                                    page heading.
                                                                </div>

                                                                <!-- Section Dropdown -->
                                                                <div style="margin-bottom: 10px;">
                                                                    {% set sectionItems = [] %}
                                                                    {% set _ = sectionItems.push({
                                                                    value: "",
                                                                    text: "No section",
                                                                    selected: not currentPage.section
                                                                    }) %}
                                                                    {% for section in sections %}
                                                                    {% set _ = sectionItems.push({
                                                                    value: section.id,
                                                                    text: section.name,
                                                                    selected: currentPage.section and
                                                                    currentPage.section.id == section.id
                                                                    }) %}
                                                                    {% endfor %}
                                                                    {{ govukSelect({
                                                                    id: "section",
                                                                    name: "section",
                                                                    items: sectionItems
                                                                    }) }}
                                                                </div>

                                                                <!-- Create New Section Link -->
                                                                <div>
                                                                    <a href="?showCreateSection=true"
                                                                        class="govuk-link govuk-link--no-visited-state">Create
                                                                        new section</a>
                                                                </div>

                                                                {% if data.showCreateSection %}
                                                                <!-- Inline Section Creation Form -->
                                                                <div class="govuk-!-margin-top-4"
                                                                    style="border-left: 5px solid #008938; padding: 15px; background-color: #fff;">
                                                                    {% if data.error %}
                                                                    <div class="govuk-error-summary"
                                                                        aria-labelledby="error-summary-title"
                                                                        role="alert" tabindex="-1"
                                                                        data-module="govuk-error-summary">
                                                                        <h2 class="govuk-error-summary__title"
                                                                            id="error-summary-title">
                                                                            There is a problem
                                                                        </h2>
                                                                        <div class="govuk-error-summary__body">
                                                                            <ul
                                                                                class="govuk-list govuk-error-summary__list">
                                                                                <li>
                                                                                    <a href="#section-name">{{
                                                                                        data.error }}</a>
                                                                                </li>
                                                                            </ul>
                                                                        </div>
                                                                    </div>
                                                                    {% endif %}

                                                                    <form
                                                                        action="/titan-mvp-1.2/form-editor/section/create"
                                                                        method="post">
                                                                        <input type="hidden" name="returnUrl"
                                                                            value="{{ data.returnUrl or '/titan-mvp-1.2/form-editor/question-type/guidance-configuration-nojs.html' }}">

                                                                        {{ govukInput({
                                                                        label: {
                                                                        text: "Section name",
                                                                        classes: "govuk-label--m",
                                                                        isPageHeading: false
                                                                        },
                                                                        hint: {
                                                                        text: "Enter a name for your new section"
                                                                        },
                                                                        id: "section-name",
                                                                        name: "sectionName",
                                                                        value: data.sectionName or '',
                                                                        errorMessage: data.error and {
                                                                        text: data.error
                                                                        }
                                                                        }) }}

                                                                        <div class="govuk-button-group">
                                                                            {{ govukButton({
                                                                            text: "Save new section",
                                                                            type: "submit"
                                                                            }) }}

                                                                            <a href="/titan-mvp-1.2/form-editor/question-type/guidance-configuration-nojs.html"
                                                                                class="govuk-link">Cancel</a>
                                                                        </div>
                                                                    </form>
                                                                </div>
                                                                {% endif %}
                                                            </fieldset>
                                                        </div>
                                                    </div>

                                                    <div class="govuk-button-group">
                                                        {{ govukButton({
                                                        text: "Save",
                                                        type: "submit",
                                                        id: "continue-button"
                                                        }) }}

                                                        <p class="govuk-body">
                                                            <a href="/titan-mvp-1/form-editor/delete/{{ currentPage.pageId }}"
                                                                class="govuk-link govuk-link--no-visited-state govuk-link--destructive hide-in-reorder-mode hide-when-edit-mode">
                                                                Delete page
                                                            </a>
                                                        </p>
                                                    </div>
                                                </form>

                                                <!-- Add Page Conditions Section -->
                                                <hr
                                                    class="govuk-section-break govuk-section-break--m govuk-section-break--visible" />

                                                <h2 class="govuk-heading-m">Page conditions</h2>
                                                <p class="govuk-body">The selected conditions will be evaluated when the
                                                    user reaches this page. If the conditions are not met then users
                                                    will not be shown this page.</p>

                                                {% if currentPage.conditions and currentPage.conditions.length > 0 %}
                                                <div class="govuk-inset-text">
                                                    <h3 class="govuk-heading-s">Current conditions</h3>
                                                    <ul class="govuk-list">
                                                        {% for condition in currentPage.conditions %}
                                                        <li
                                                            style="display: flex; align-items: center; margin-bottom: 5px;">
                                                            <svg style="min-width: 24px; margin-right: 10px;" width="24"
                                                                height="24" viewBox="0 0 24 24" fill="none"
                                                                stroke="#00703c" stroke-width="2">
                                                                <path d="M20 6L9 17l-5-5"></path>
                                                            </svg>
                                                            {% set cleanText = condition.text | replace(" (radios)", "")
                                                            %}
                                                            {{ cleanText }}
                                                        </li>
                                                        {% endfor %}
                                                    </ul>
                                                </div>
                                                {% else %}
                                                <div class="govuk-inset-text">
                                                    <p class="govuk-body">No conditions have been added to this page
                                                        yet.</p>
                                                </div>
                                                {% endif %}

                                                {% if currentPage and currentPage.pageId %}
                                                {{ govukButton({
                                                text: "Manage conditions",
                                                href: "/titan-mvp-1/form-editor/conditions/page-level/" +
                                                currentPage.pageId,
                                                classes: "govuk-button"
                                                }) }}
                                                {% else %}
                                                <p class="govuk-body">Error: Page ID not found</p>
                                                <pre>{{ currentPage | dump }}</pre>
                                                {% endif %}
                                            </div>
                                        </div>
                                    </div>
                                </dd>
                            </div>
                        </dl>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}