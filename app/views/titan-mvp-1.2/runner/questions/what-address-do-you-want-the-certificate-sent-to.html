{% extends "layouts/runner.html" %}

{% block pageTitle %}
What address do you want the certificate sent to? – {{ serviceName }} – GOV.UK
{% endblock %}

{% block beforeContent %}
{{ govukBackLink({
text: "Back",
href: "javascript:window.history.back()"
}) }}
{% endblock %}

{% block content %}

<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">

    <h1 class="govuk-heading-l">What address do you want the certificate sent to?</h1>

    <div class="govuk-button-group">
      {{ govukButton({
      text: "Find address",
      href: "/address-lookup-postcode?returnUrl=" + (data.returnUrl or "/what-address-do-you-want-the-certificate-sent-to")
      }) }}

      {{ govukButton({
      text: "Enter address manually",
      classes: "govuk-button--secondary",
      href: "/address-lookup-manual?returnUrl=" + (data.returnUrl or "/what-address-do-you-want-the-certificate-sent-to")
      }) }}

      {{ govukButton({
      text: "Save and exit",
      classes: "govuk-button--secondary",
      href: "/save-progress",
      type: "button",
      attributes: {
        "data-save-exit": "true"
      }
      }) }}
    </div>

    {% if data['AegFro-address-line-1'] %}
    <div class="govuk-inset-text">
      <strong>Selected address:</strong><br>
      {{ data['AegFro-address-line-1'] }}<br>
      {% if data['AegFro-address-line-2'] %}{{ data['AegFro-address-line-2'] }}<br>{% endif %}
      {{ data['AegFro-town'] }}<br>
      {{ data['AegFro-postcode'] }}
    </div>

    <form class="form" action="/what-address-do-you-want-the-certificate-sent-to" method="post">
      <div class="govuk-button-group">
        {{ govukButton({
        text: "Continue"
        }) }}

        {{ govukButton({
        text: "Change address",
        classes: "govuk-button--secondary",
        href: "/address-lookup-postcode?returnUrl=" + (data.returnUrl or "/what-address-do-you-want-the-certificate-sent-to")
        }) }}
      </div>
    </form>
    {% endif %}

  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const saveExitButton = document.querySelector('[data-save-exit="true"]');
  
  if (saveExitButton) {
    saveExitButton.addEventListener('click', function(e) {
      e.preventDefault();
      
      // Get the current page URL
      const currentUrl = window.location.pathname;
      
      // Redirect to save-progress with the current page as returnUrl
      window.location.href = '/save-progress?returnUrl=' + encodeURIComponent(currentUrl);
    });
  }
});
</script>

{% endblock %}
